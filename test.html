<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title></title>
</head>

<body>

<ul class="test-results"></ul>

<script type="text/javascript" src="./Future.js"></script>

<script type="text/javascript">
	
	var futureCounts = 0,
		
		ul = document.querySelector("ul.test-results"),
		
		CONST = {			
			FUTURE_CLASS_NAME : "_cls_Future",
			SWEAR_CLASS_NAME : "_cls_Future_Swear"
		},
		
		util = {
			
			isFuture : function (f) {
				if (f instanceof Object && typeof f.constructor == "function") {
					if (f.constructor.name === CONST.FUTURE_CLASS_NAME) {
						return true;
					} else {
						// For IE <= 10
						var patt = new RegExp("function " + CONST.FUTURE_CLASS_NAME, "m");
						return patt.test(f.constructor.toString());
					}
				}
				return false;
			},
			
			isSwear : function (s) {
				if (s instanceof Object && typeof s.constructor == "function") {
					if (s.constructor.name === CONST.SWEAR_CLASS_NAME) {
						return true;
					} else {
						// For IE <= 10
						var patt = new RegExp("function " + CONST.SWEAR_CLASS_NAME, "m");
						return patt.test(s.constructor.toString());
					}
				}
				return false;
			},
			
			cleanFuture : function () {		
				for (var i = 0; i < futureCounts; i++) {
					Future.rmOne("f" + i);
				}
			}			
		},
		
		smokeTests = {
			
			tests : [],
			
			add : function (tag, test) {				
				if (typeof test == "function") {
					test._tag = tag;
					this.tests.push(test);
				}
			},
			
			run : function () {
				
				var base = document.createElement("li");
				base.className = "test-results-result";
				
				var li;
				
				for (var i = 0; i < this.tests.length; i++) {
					
					li = base.cloneNode(true);
					li.innerHTML = "TEST :&nbsp;&nbsp;" + this.tests[i]._tag;
					try {
						li._errMsg = this.tests[i]();
					} catch(e) {
						li._errMsg = e.toString() + "<br/>&nbsp;&nbsp;&nbsp;&nbsp;" + e.stack;
					}
					if (li._errMsg !== true) {					
						li.className += " error";
						li.style.cssText = "color: red;";
						if (typeof li._errMsg === "string") {
							li.innerHTML += "<br/>" + li._errMsg;
						}						
					}
					
					ul.appendChild(li);
				}
			}
		};	
	
	smokeTests.add("New future", function () {		
		var n = "f" + futureCounts++,
			f = Future.newOne(n);		
		return util.isFuture(f);
	});
	
	smokeTests.add("Double new future", function () {			
		var n = "f" + futureCounts++,
			f0 = Future.newOne(n),
			f1 = Future.newOne(n);		
		return f0 === f1;
	});
	
	smokeTests.add("Future Exist", function () {
		var n = "f" + futureCounts++;
			Future.newOne(n);
		return Future.exist(n);
	});
	
	smokeTests.add("Remove future", function () {
		var n = "f" + futureCounts++,
			f0 = Future.newOne(n),
			f1 = Future.rmOne(n);
		return !Future.exist(n) && f0 === f1;
	});
	
	smokeTests.add("Get future name", function () {
		var i, n = [], f = [];
				
		for (i = 0; i < 3; i++) {
			n[i] = "f" + futureCounts++;
			f[i] = Future.newOne(n[i]);
		}
		
		for (i = 0; i < n.length; i++) {
			if (f[i].getName() !== n[i]) {
				return "The expected future name:" + n[i] + "but the actual future name" + f[i].getName();
			}
		}
		return true;
	});
	
	smokeTests.add("Chain futures", function () {		
		var f = Future.newOne("f" + futureCounts++);
		
		f = f.next(function() {});
		if (util.isFuture(f)) {
		
			f = f.next(function() {});
			if (util.isFuture(f)) {
			
				f = f.fall(function() {});
				if (util.isFuture(f)) {
				
					f = f.fall(function() {});
					if (util.isFuture(f)) {
					
						f = f.next(function() {});
						if (util.isFuture(f)) {
						
							return true;
						}
					}
				}
			}
		}
		
		return false;
	});
	
	smokeTests.add("Inform future", function () {
	
		var count = 0,
			f = Future.newOne("f" + futureCounts++);
		
		f.during(function () {
			for (var i = 0; i <arguments.length; i++) {
				count += arguments[i];
			}
		  })
		 .inform(1);
		
		if (count != 1) return "The expected count = 1 but the actual count = " + count;		
		
		count = 0;
		
		f.during(function () {
			for (var i = 0; i <arguments.length; i++) {
				count += arguments[i];
			}
		  })
		 .inform([1, 1]);
		
		if (count != 4) return "The expected count = 4 but the actual count = " + count;
		
		return true;
	});
	
	smokeTests.add("Approve future", function () {		
		var count = 0,
			f = Future.newOne("f" + futureCounts++);
		
		f.next(function(num) { count += num; })
		 .next(function(num) { count += num; })
		 .fall(function(num) { count -= num; })
		 .fall(function(num) { count -= num; })
		 .next(function(num) { count += num; })
		 .approve([1]);
		
		if (count !== 3) {
			return "The expected count = 3 but the actual count = " + count;
		}
		
		count = 0;
		f = Future.newOne("f" + futureCounts++);
		f.next(function(num) { count += num; })
		 .fall(function(num) { count -= num; })
		 .approve(2);
		 
		if (count !== 2) {
			return "The expected count = 2 but the actual count = " + count;
		}
		
		return true;
	});
	
	smokeTests.add("Double approve future", function () {		
		var count = 0,
			f = Future.newOne("f" + futureCounts++);
		
		f.next(function(num) { count = num; })
		 .approve(1);
		
		f.approve(2);
		f.next(function(num) { count = num; });
		 
		if (count !== 1) {
			return "The expected count = 1 but the actual count = " + count;
		}
		
		return true;
	});
	
	smokeTests.add("Disapprove future", function () {		
		var count = 0,
			f = Future.newOne("f" + futureCounts++);
		
		f.next(function(num) { count += num; })
		 .next(function(num) { count += num; })
		 .fall(function(num) { count -= num; })
		 .fall(function(num) { count -= num; })
		 .next(function(num) { count += num; })
		 .disapprove(1);
		
		if (count !== -2) {
			return "The expected count = -2 but the actual count = " + count;
		}
		
		count = 0;
		f = Future.newOne("f" + futureCounts++);
		
		f.next(function(num) { count += num; })
		 .fall(function(num) { count -= num; })
		 .disapprove(3);
		
		if (count !== -3) {
			return "The expected count = -3 but the actual count = " + count;
		}
		
		return true;
	});
	
	smokeTests.add("Double disapprove future", function () {		
		var count = 0,
			f = Future.newOne("f" + futureCounts++);
		
		f.fall(function(num) { count = num; })
		 .disapprove(1);
		
		f.disapprove(2);
		f.fall(function(num) { count = num; });
		 
		if (count !== 1) {
			return "The expected count = 1 but the actual count = " + count;
		}
		
		return true;
	});
	
	smokeTests.add("Approve future anyway", function () {
		
		var sum = 0,
			f = Future.newOne("f" + futureCounts++);
		
		f.next(function (num) {
			sum += num;
		  })
		 .anyway(function (num) {
			sum += num;
		  })
		 .fall(function (num) {
			sum -= num;
		  });
		  
		f.approve(1);
		
		return sum == 2;
	});
	
	smokeTests.add("Disapprove future anyway", function () {
		
		var sum = 0,
			f = Future.newOne("f" + futureCounts++);
		
		f.next(function (num) {
			sum += num;
		  })
		 .anyway(function (num) {
			sum += num;
		  })
		 .fall(function (num) {
			sum -= num;
		  });
		  
		f.disapprove(1);
		
		return sum == 0;
	});
	
	smokeTests.add("Report future", function () {
		var f0 = Future.newOne("f" + futureCounts++),
			f1 = Future.newOne("f" + futureCounts++),
			f2 = Future.newOne("f" + futureCounts++);
		
		f0.approve();
		if (f0.report() != Future.FLAG_FUTURE_IS_OK) {
			return false;	
			f0.disapprove();
			if (f0.report() != Future.FLAG_FUTURE_IS_OK) {
				return false;
			}
		}
		
		f1.disapprove();
		if (f1.report() != Future.FLAG_FUTURE_IS_ERR) {
			return false;
			f1.approve();
			if (f1.report() != Future.FLAG_FUTURE_IS_ERR) {
				return false;
			}
		}
		
		if (f2.report() != Future.FLAG_FUTURE_NOT_YET) {
			return false;
			f2.approve();
			if (f2.report() != Future.FLAG_FUTURE_IS_OK) {
				return false;
			}
		}
		
		return true;
	});
	
	smokeTests.add("Swear future", function () {
		return util.isSwear(Future.newOne("f" + futureCounts++).swear());
	});	
	
	smokeTests.add("Chain swears", function () {		
		var s = Future.newOne("f" + futureCounts++).swear();
		
		s = s.next(function() {});
		if (util.isSwear(s)) {
		
			s = s.next(function() {});
			if (util.isSwear(s)) {
			
				s = s.fall(function() {});
				if (util.isSwear(s)) {
				
					s = s.fall(function() {});
					if (util.isSwear(s)) {
					
						s = s.next(function() {});
						if (util.isSwear(s)) {
						
							return true;
						}
					}
				}
			}
		}
		
		return false;
	});
	
	smokeTests.add("Inform swear", function () {
	
		var count = 0,
			f = Future.newOne("f" + futureCounts++)
			s = f.swear();
		
		s.during(function () {
			for (var i = 0; i <arguments.length; i++) {
				count += arguments[i];
			}
		  });
		f.inform(1);
		
		if (count != 1) return "The expected count = 1 but the actual count = " + count;		
		
		count = 0;
		
		s.during(function () {
			for (var i = 0; i <arguments.length; i++) {
				count += arguments[i];
			}
		  });
		f.inform([1, 1]);
		
		if (count != 4) return "The expected count = 4 but the actual count = " + count;
		
		return true;
	});
	
	smokeTests.add("Approve swear", function () {		
		var count = 0,
			f = Future.newOne("f" + futureCounts++),
			s = f.swear();
		
		s.next(function(num) { count += num; })
		 .next(function(num) { count += num; })
		 .fall(function(num) { count -= num; })
		 .fall(function(num) { count -= num; })
		 .next(function(num) { count += num; });
		
		f.approve([1]);
		
		if (count !== 3) {
			return "The expected count = 3 but the actual count = " + count;
		}
		
			
		count = 0;
		f = Future.newOne("f" + futureCounts++);
		s = f.swear();
		
		s.fall(function(num) { count -= num; })
		 .next(function(num) { count += num; });
		
		f.approve(2);
		
		if (count !== 2) {
			return "The expected count = 2 but the actual count = " + count;
		}
		
		return true;
	});	
	
	smokeTests.add("Disapprove swear", function () {		
		var count = 0,
			f = Future.newOne("f" + futureCounts++),
			s = f.swear();
		
		s.next(function(num) { count += num; })
		 .next(function(num) { count += num; })
		 .fall(function(num) { count -= num; })
		 .fall(function(num) { count -= num; })
		 .next(function(num) { count += num; });
		
		f.disapprove([1]);
		
		if (count !== -2) {
			return "The expected count = -2 but the actual count = " + count;
		}
			
		count = 0;
		f = Future.newOne("f" + futureCounts++);
		s = f.swear();
		
		s.fall(function(num) { count -= num; })
		 .next(function(num) { count += num; });
		
		f.disapprove(3);
		
		if (count !== -3) {
			return "The expected count = -3 but the actual count = " + count;
		}
		
		return true;
	});
		
	smokeTests.add("Approve swear anyway", function () {
		
		var sum = 0,
			f = Future.newOne("f" + futureCounts++);
		
		f.swear()
		 .next(function (num) {
			sum += num;
		  })
		 .anyway(function (num) {
			sum += num;
		  })
		 .fall(function (num) {
			sum -= num;
		  });
		  
		f.approve(1);
		
		return sum == 2;
	});
	
	smokeTests.add("Disapprove swear anyway", function () {
		
		var sum = 0,
			f = Future.newOne("f" + futureCounts++);
		
		f.swear()
		 .next(function (num) {
			sum += num;
		  })
		 .anyway(function (num) {
			sum += num;
		  })
		 .fall(function (num) {
			sum -= num;
		  });
		  
		f.disapprove(1);
		
		return sum == 0;
	});
	
	smokeTests.add("Report swear", function () {
		var f0 = Future.newOne("f" + futureCounts++), s0 = f0.swear(),
			f1 = Future.newOne("f" + futureCounts++), s1 = f1.swear(),
			f2 = Future.newOne("f" + futureCounts++), s2 = f2.swear();
		
		f0.approve();
		if (s0.report() != Future.FLAG_FUTURE_IS_OK) {
			return false;	
			f0.disapprove();
			if (s0.report() != Future.FLAG_FUTURE_IS_OK) {
				return false;
			}
		}
		
		f1.disapprove();
		if (s1.report() != Future.FLAG_FUTURE_IS_ERR) {
			return false;
			f1.approve();
			if (s1.report() != Future.FLAG_FUTURE_IS_ERR) {
				return false;
			}
		}
		
		if (s2.report() != Future.FLAG_FUTURE_NOT_YET) {
			return false;
			f2.approve();
			if (s2.report() != Future.FLAG_FUTURE_IS_OK) {
				return false;
			}
		}
		
		return true;
	});
	
	smokeTests.add("Swear swear", function () {
		return util.isSwear(Future.newOne("f" + futureCounts++).swear().swear());
	});		
		
	smokeTests.add("Dump futures", function () {
		
		util.cleanFuture();
		
		var exp,
			act,
			dumps,
			token = " ",
			f0 = Future.newOne("f" + futureCounts++),
			f1 = Future.newOne("f" + futureCounts++),
			f2 = Future.newOne("f" + futureCounts++),
			f3 = Future.newOne("f" + futureCounts++),
			f4 = Future.newOne("f" + futureCounts++),
			f5 = Future.newOne("f" + futureCounts++);
				
		f0.approve();
		f1.approve();
		f2.disapprove();
		f3.disapprove();
			
		dumps = Future.dump();
		if (dumps.length !== 0) throw new Error;
		
		dumps = Future.dump(true);
		if (dumps.length !== 0) throw new Error;
		
		dumps = Future.dump(Future.FLAG_FUTURE_IS_OK);
		exp =  dumps.join(token);
		act = [ f0.getName(), f1.getName() ].join(token);
		if (exp !== act) {
			act = [ f1.getName(), f0.getName() ].join(token);
			if (exp !== act) throw new Error("Expected OK = " + exp + " but Actual OK = " + act);
		}
		
		dumps = Future.dump(Future.FLAG_FUTURE_IS_ERR);
		exp =  dumps.join(token);
		act = [ f2.getName(), f3.getName() ].join(token);
		if (exp !== act) {
			act = [ f3.getName(), f2.getName() ].join(token);
			if (exp !== act) throw new Error("Expected Error = " + exp + " but Actual Error = " + act);
		}
		
		dumps = Future.dump(Future.FLAG_FUTURE_NOT_YET);
		exp =  dumps.join(token);
		act = [ f4.getName(), f5.getName() ].join(token);
		if (exp !== act) {
			act = [ f5.getName(), f4.getName() ].join(token);
			if (exp !== act) throw new Error("Expected Unsettled = " + exp + " but Actual Unsettled = " + act);
		}
		
		return true;
	});
	
	smokeTests.add("Future and then", function () {
		
		var s, f;
		
		f = Future.newOne("f" + futureCounts++);
		s = f.andThen();
		if (!util.isSwear(s)) {
			throw new Error;
		} else {
			f.next(function (a, b) { s = a + b; });
			f.approve([100, 100]);			
			if (s !== 200) throw new Error;
		}
		
		f = Future.newOne("f" + futureCounts++);
		s = f.andThen()
			 .next(function (a, b) { s = a + b; });
		if (!util.isSwear(s)) {
			throw new Error;
		} else {
			f.approve([100, 100]);			
			if (s !== 200) throw new Error;
		}
		
		f = Future.newOne("f" + futureCounts++);
		s = f.andThen(null, function () {});
		if (!util.isSwear(s)) {
			throw new Error;
		} else {
			f.next(function (a, b) { s = a + b; });
			f.approve([100, 100]);			
			if (s !== 200) throw new Error;
		}
		
		f = Future.newOne("f" + futureCounts++);
		s = f.andThen(null, function () {})
			 .next(function (a, b) { s = a + b; });
		if (!util.isSwear(s)) {
			throw new Error;
		} else {
			f.approve([100, 100]);			
			if (s !== 200) throw new Error;
		}
		
		f = Future.newOne("f" + futureCounts++);
		s = f.andThen(function () {}, null);
		if (!util.isSwear(s)) {
			throw new Error;
		} else {
			f.fall(function (a, b) { s = a + b; });
			f.disapprove([100, 100]);			
			if (s !== 200) throw new Error;
		}
		
		f = Future.newOne("f" + futureCounts++);
		s = f.andThen(function () {}, null)
			 .fall(function (a, b) { s = a + b; });
		if (!util.isSwear(s)) {
			throw new Error;
		} else {
			f.disapprove([100, 100]);			
			if (s !== 200) throw new Error;
		}		
				
		return true;
	});
	
	smokeTests.add("Future and then new value", function () {
		
		var s ,f;		
		
		f = Future.newOne("f" + futureCounts++);
		s = f.andThen(
			function (a, b) {
				return [ 2 * a, 2 * b ];
			},
			null
		);
		if (!util.isSwear(s)) {
			throw new Error;
		} else {
			f.next(function (a, b) {
				s = a + b; 
			});
			f.approve([100, 100]);			
			if (s !== 200) throw new Error;
		}
		
		f = Future.newOne("f" + futureCounts++);
		s = f.andThen(
				function (a, b) {
					return [ 2 * a, 2 * b ];
				},
				null
			)
			.next(function (a, b) {
				s = a + b; 
			});
		if (!util.isSwear(s)) {
			throw new Error;
		} else {
			f.approve([100, 100]);			
			if (s !== 400) throw new Error;
		}		
		
		f = Future.newOne("f" + futureCounts++);
		s = f.andThen(
				function (a, b) {
					return [ 2 * a, 2 * b ];
				},
				function () { return [ -2 * a, -2 * b ]; }
			).next(function (a, b) {
				s = a + b; 
			});
		if (!util.isSwear(s)) {
			throw new Error;
		} else {
			f.approve([100, 100]);			
			if (s !== 400) throw new Error;
		}		
		
		
		f = Future.newOne("f" + futureCounts++);
		s = f.andThen(
			null,
			function (a, b) {
				return [ 2 * a, 2 * b ];
			}
		);
		if (!util.isSwear(s)) {
			throw new Error;
		} else {
			f.fall(function (a, b) {
				s = a + b; 
			});
			f.disapprove([100, 100]);			
			if (s !== 200) throw new Error;
		}
		
		f = Future.newOne("f" + futureCounts++);
		s = f.andThen(				
				null,
				function (a, b) {
					return [ 2 * a, 2 * b ];
				}
			).fall(function (a, b) {
				s = a + b; 
			});
		if (!util.isSwear(s)) {
			throw new Error;
		} else {
			f.disapprove([100, 100]);			
			if (s !== 400) throw new Error;
		}
		
		
		f = Future.newOne("f" + futureCounts++);
		s = f.andThen(			
			function () { return [ -2 * a, -2 * b ]; },
			function (a, b) {
				return [ 2 * a, 2 * b ];
			}
		);
		if (!util.isSwear(s)) {
			throw new Error;
		} else {
			f.fall(function (a, b) {
				s = a + b; 
			});
			f.disapprove([100, 100]);			
			if (s !== 200) throw new Error;
		}
		
		f = Future.newOne("f" + futureCounts++);
		s = f.andThen(
				function () { return [ -2 * a, -2 * b ]; },
				function (a, b) {
					return [ 2 * a, 2 * b ];
				}
			).fall(function (a, b) {
				s = a + b; 
			});
		if (!util.isSwear(s)) {
			throw new Error;
		} else {
			f.disapprove([100, 100]);			
			if (s !== 400) throw new Error;
		}
		
		return true;
	});
		
	smokeTests.add("Future and then original future", function () {
		
		var s, f;
		
		f = Future.newOne("f" + futureCounts++);
		s = f.andThen(
				function () { return f; },
				null
			);		
		if (!util.isSwear(s)) {
			throw new Error;
		} else {
			f.next(function (a, b) {
				s = a + b;
			});
			f.approve([100, 100]);			
			if (s !== 200) throw new Error;
		}
		
		f = Future.newOne("f" + futureCounts++);
		s = f.andThen(
				function () { return f; },
				null
			)
			.next(function (a, b) {
				s = a + b;
			});	
		if (!util.isSwear(s)) {
			throw new Error;
		} else {
			f.approve([100, 100]);			
			if (s !== 200) throw new Error;
		}	
		
		f = Future.newOne("f" + futureCounts++);
		s = f.andThen(
				function () { return f.swear(); },
				null
			);		
		if (!util.isSwear(s)) {
			throw new Error;
		} else {
			f.next(function (a, b) {
				s = a + b;
			});
			f.approve([100, 100]);			
			if (s !== 200) throw new Error;
		}
		
		f = Future.newOne("f" + futureCounts++);
		s = f.andThen(
				function () { return f.swear(); },
				null
			)
			.next(function (a, b) {
				s = a + b;
			});	
		if (!util.isSwear(s)) {
			throw new Error;
		} else {
			f.approve([100, 100]);			
			if (s !== 200) throw new Error;
		}	
		
		f = Future.newOne("f" + futureCounts++);
		s = f.andThen(
				function () { return f; },
				function () { return null; }
			)
			.next(function (a, b) {
				s = a + b;
			});	
		if (!util.isSwear(s)) {
			throw new Error;
		} else {
			f.approve([100, 100]);			
			if (s !== 200) throw new Error;
		}		
		
		f = Future.newOne("f" + futureCounts++);
		s = f.andThen(
				null,
				function () { return f; }
			);		
		if (!util.isSwear(s)) {
			throw new Error;
		} else {
			f.fall(function (a, b) {
				s = a + b;
			});
			f.disapprove([100, 100]);			
			if (s !== 200) throw new Error;
		}
		
		f = Future.newOne("f" + futureCounts++);
		s = f.andThen(
				null,
				function () { return f; }
			)
			.fall(function (a, b) {
				s = a + b;
			});	
		if (!util.isSwear(s)) {
			throw new Error;
		} else {
			f.disapprove([100, 100]);			
			if (s !== 200) throw new Error;
		}	
		
		f = Future.newOne("f" + futureCounts++);
		s = f.andThen(
				null, 
				function () { return f.swear(); }
			);		
		if (!util.isSwear(s)) {
			throw new Error;
		} else {
			f.fall(function (a, b) {
				s = a + b;
			});
			f.disapprove([100, 100]);			
			if (s !== 200) throw new Error;
		}
		
		f = Future.newOne("f" + futureCounts++);
		s = f.andThen(
				null,
				function () { return f.swear(); }
			)
			.fall(function (a, b) {
				s = a + b;
			});	
		if (!util.isSwear(s)) {
			throw new Error;
		} else {
			f.disapprove([100, 100]);			
			if (s !== 200) throw new Error;
		}	
		
		f = Future.newOne("f" + futureCounts++);
		s = f.andThen(
				function () { return null; },
				function () { return f; }
			)
			.fall(function (a, b) {
				s = a + b;
			});	
		if (!util.isSwear(s)) {
			throw new Error;
		} else {
			f.disapprove([100, 100]);			
			if (s !== 200) throw new Error;
		}
		
		return true;
	});
	
	smokeTests.add("Future and then new future", function () {
		
		var s, f, nf;
		
		nf = null;
		f = Future.newOne("f" + futureCounts++);
		s = f.andThen(
				function () {
					nf = Future.newOne("f" + futureCounts++);
					return nf;
				},
				null
			);	
		if (!util.isSwear(s)) {
			throw new Error;
		} else {
		
			f.next(function (a, b) {
				s = a + b;
			});
			
			if (util.isFuture(nf)) throw new Error;
			
			f.approve([100, 100]);
			nf.approve([-100, -100]);	
			
			if (s !== 200) throw new Error;
		}
		
		nf = null;
		f = Future.newOne("f" + futureCounts++);
		s = f.andThen(
				function () {
					nf = Future.newOne("f" + futureCounts++);
					return nf;
				},
				null
			)
			.next(function (a, b) {
				s = a + b;
			});
		if (!util.isSwear(s)) {
			throw new Error;
		} else {			
			if (util.isFuture(nf)) throw new Error;
			
			f.approve([100, 100]);
			nf.approve([-100, -100]);	
			
			if (s !== -200) throw new Error;
		}
		
		nf = null;
		f = Future.newOne("f" + futureCounts++);
		s = f.andThen(
				function () {
					nf = Future.newOne("f" + futureCounts++);
					return nf;
				},
				function () {
					return f;
				}
			);	
		if (!util.isSwear(s)) {
			throw new Error;
		} else {
		
			f.next(function (a, b) {
				s = a + b;
			});
			
			if (util.isFuture(nf)) throw new Error;
			
			f.approve([100, 100]);
			nf.approve([-100, -100]);	
			
			if (s !== 200) throw new Error;
		}
		
		nf = null;
		f = Future.newOne("f" + futureCounts++);
		s = f.andThen(
				function () {
					nf = Future.newOne("f" + futureCounts++);
					return nf;
				},
				function () {
					return f;
				}
			)
			.next(function (a, b) {
				s = a + b;
			});
		if (!util.isSwear(s)) {
			throw new Error;
		} else {			
			if (util.isFuture(nf)) throw new Error;
			
			f.approve([100, 100]);
			nf.approve([-100, -100]);	
			
			if (s !== -200) throw new Error;
		}
		
		nf = null;
		f = Future.newOne("f" + futureCounts++);
		s = f.andThen(
				null, 
				function () {
					nf = Future.newOne("f" + futureCounts++);
					return nf;
				}
			);	
		if (!util.isSwear(s)) {
			throw new Error;
		} else {
		
			f.fall(function (a, b) {
				s = a + b;
			});
			
			if (util.isFuture(nf)) throw new Error;
			
			f.disapprove([100, 100]);
			nf.disapprove([-100, -100]);	
			
			if (s !== 200) throw new Error;
		}
		
		nf = null;
		f = Future.newOne("f" + futureCounts++);
		s = f.andThen(
				null,
				function () {
					nf = Future.newOne("f" + futureCounts++);
					return nf;
				}
			)
			.fall(function (a, b) {
				s = a + b;
			});
		if (!util.isSwear(s)) {
			throw new Error;
		} else {			
			if (util.isFuture(nf)) throw new Error;
			
			f.disapprove([100, 100]);
			nf.disapprove([-100, -100]);	
			
			if (s !== -200) throw new Error;
		}
		
		nf = null;
		f = Future.newOne("f" + futureCounts++);
		s = f.andThen(
				function () {
					return f;
				},
				function () {
					nf = Future.newOne("f" + futureCounts++);
					return nf;
				}
			);	
		if (!util.isSwear(s)) {
			throw new Error;
		} else {
		
			f.fall(function (a, b) {
				s = a + b;
			});
			
			if (util.isFuture(nf)) throw new Error;
			
			f.disapprove([100, 100]);
			nf.disapprove([-100, -100]);	
			
			if (s !== 200) throw new Error;
		}
		
		nf = null;
		f = Future.newOne("f" + futureCounts++);
		s = f.andThen(
				function () {
					return f;
				},
				function () {
					nf = Future.newOne("f" + futureCounts++);
					return nf;
				}
			)
			.fall(function (a, b) {
				s = a + b;
			});
		if (!util.isSwear(s)) {
			throw new Error;
		} else {			
			if (util.isFuture(nf)) throw new Error;
			
			f.disapprove([100, 100]);
			nf.disapprove([-100, -100]);	
			
			if (s !== -200) throw new Error;
		}
		
		return true;
	});
	
	smokeTests.add("Future and then new swear", function () {
		
		var s, f, ns, nf;
		
		ns = nf = null;
		f = Future.newOne("f" + futureCounts++);
		s = f.andThen(
				function () {
					nf = Future.newOne("f" + futureCounts++);
					ns = nf.swear(); return ns;
				},
				null
			);	
		if (!util.isSwear(s)) {
			throw new Error;
		} else {
		
			f.next(function (a, b) {
				s = a + b;
			});
			
			if (util.isFuture(nf)) throw new Error;
			
			f.approve([100, 100]);
			nf.approve([-100, -100]);	
			
			if (s !== 200) throw new Error;
		}
		
		ns = nf = null;
		f = Future.newOne("f" + futureCounts++);
		s = f.andThen(
				function () {
					nf = Future.newOne("f" + futureCounts++);
					ns = nf.swear(); return ns;
				},
				null
			)
			.next(function (a, b) {
				s = a + b;
			});
		if (!util.isSwear(s)) {
			throw new Error;
		} else {			
			if (util.isFuture(nf)) throw new Error;
			
			f.approve([100, 100]);
			nf.approve([-100, -100]);	
			
			if (s !== -200) throw new Error;
		}
		
		ns = nf = null;
		f = Future.newOne("f" + futureCounts++);
		s = f.andThen(
				function () {
					nf = Future.newOne("f" + futureCounts++);
					ns = nf.swear(); return ns;
				},
				function () {
					return f;
				}
			);	
		if (!util.isSwear(s)) {
			throw new Error;
		} else {
		
			f.next(function (a, b) {
				s = a + b;
			});
			
			if (util.isFuture(nf)) throw new Error;
			
			f.approve([100, 100]);
			nf.approve([-100, -100]);	
			
			if (s !== 200) throw new Error;
		}
		
		ns = nf = null;
		f = Future.newOne("f" + futureCounts++);
		s = f.andThen(
				function () {
					nf = Future.newOne("f" + futureCounts++);
					ns = nf.swear(); return ns;
				},
				function () {
					return f;
				}
			)
			.next(function (a, b) {
				s = a + b;
			});
		if (!util.isSwear(s)) {
			throw new Error;
		} else {			
			if (util.isFuture(nf)) throw new Error;
			
			f.approve([100, 100]);
			nf.approve([-100, -100]);	
			
			if (s !== -200) throw new Error;
		}
		
		ns = nf = null;
		f = Future.newOne("f" + futureCounts++);
		s = f.andThen(
				null, 
				function () {
					nf = Future.newOne("f" + futureCounts++);
					ns = nf.swear(); return ns;
				}
			);	
		if (!util.isSwear(s)) {
			throw new Error;
		} else {
		
			f.fall(function (a, b) {
				s = a + b;
			});
			
			if (util.isFuture(nf)) throw new Error;
			
			f.disapprove([100, 100]);
			nf.disapprove([-100, -100]);	
			
			if (s !== 200) throw new Error;
		}
		
		ns = nf = null;
		f = Future.newOne("f" + futureCounts++);
		s = f.andThen(
				null,
				function () {
					nf = Future.newOne("f" + futureCounts++);
					ns = nf.swear(); return ns;
				}
			)
			.fall(function (a, b) {
				s = a + b;
			});
		if (!util.isSwear(s)) {
			throw new Error;
		} else {			
			if (util.isFuture(nf)) throw new Error;
			
			f.disapprove([100, 100]);
			nf.disapprove([-100, -100]);	
			
			if (s !== -200) throw new Error;
		}
		
		ns = nf = null;
		f = Future.newOne("f" + futureCounts++);
		s = f.andThen(
				function () {
					return f;
				},
				function () {
					nf = Future.newOne("f" + futureCounts++);
					ns = nf.swear(); return ns;
				}
			);	
		if (!util.isSwear(s)) {
			throw new Error;
		} else {
		
			f.fall(function (a, b) {
				s = a + b;
			});
			
			if (util.isFuture(nf)) throw new Error;
			
			f.disapprove([100, 100]);
			nf.disapprove([-100, -100]);	
			
			if (s !== 200) throw new Error;
		}
		
		ns = nf = null;
		f = Future.newOne("f" + futureCounts++);
		s = f.andThen(
				function () {
					return f;
				},
				function () {
					nf = Future.newOne("f" + futureCounts++);
					ns = nf.swear(); return ns;
				}
			)
			.fall(function (a, b) {
				s = a + b;
			});
		if (!util.isSwear(s)) {
			throw new Error;
		} else {
			if (util.isFuture(nf)) throw new Error;
			
			f.disapprove([100, 100]);
			nf.disapprove([-100, -100]);	
			
			if (s !== -200) throw new Error;
		}
		
		return true;
		
	});
		
	smokeTests.add("Future inform and then", function () {
		
		var f,
			msg = "",
			exp = "",
			sugar = " sugar ",
			next0 = " next_0 ",
			fall0 = " fall_0 ",
			during0 = " during_0 ",
			next1 = " next_1 ",
			fall1 = " fall_1 ";
		
		function inform() {
			f.inform("");
			exp += during0;
			if (exp !== msg) throw new Error("Expected = " + exp + " but Actual = " + msg);
		}
		
		function setup() {
			
			msg = exp = "";
			
			f = Future.newOne("f" + futureCounts++);
			
			f.andThen(
					function (txt) {
						msg += next0 + txt;
						return sugar;
					},
					function (txt) {
						msg += fall0 + txt;
						return sugar;				
					},
					null
			  )
			 .next(function (txt) {
					msg += next1 + txt;
			  })
			 .fall(function (txt) {	
					msg += fall1 + txt;	  
			  })
			 .during(function (txt) {
				msg += during0 + txt;
			 });
		 }
		
		setup();
		inform();
		inform();
		inform();		
		
		f.approve("");
		exp += next0 + next1 + sugar;
		if (exp !== msg) throw new Error("Expected = " + exp + " but Actual = " + msg);
		
		setup();
		inform();
		inform();
		inform();		
		
		f.disapprove("");
		exp += fall0 + fall1 + sugar;
		if (exp !== msg) throw new Error("Expected = " + exp + " but Actual = " + msg);		
		
		return true;
	});
	
	smokeTests.add("Future inform and then original future", function () {
		
		var f,
			msg = "",
			exp = "",
			sugar = " sugar ",
			next0 = " next_0 ",
			fall0 = " fall_0 ",
			during0 = " during_0 ",
			next1 = " next_1 ",
			fall1 = " fall_1 ",
			during1 = " during_1 ";
		
		function inform() {
			f.inform("");
			exp += during0 + during1;
			if (exp !== msg) throw new Error("Expected = " + exp + " but Actual = " + msg);
		}
		
		function setup() {
			
			msg = exp = "";
			
			f = Future.newOne("f" + futureCounts++);
			
			f.andThen(
					function (txt) {
						msg += next0 + txt;
						return sugar;
					},
					function (txt) {
						msg += fall0 + txt;
						return sugar;				
					},
					function (txt) {
						msg += during0 + txt;
						return f;
					}
			  )
			 .next(function (txt) {
					msg += next1 + txt;
			  })
			 .fall(function (txt) {	
					msg += fall1 + txt;	  
			  })
			 .during(function (txt) {
				msg += during1 + txt;
			 });
		 }
		
		setup();
		inform();
		inform();
		inform();		
		
		f.approve("");
		exp += next0 + next1 + sugar;
		if (exp !== msg) throw new Error("Expected = " + exp + " but Actual = " + msg);
		
		setup();
		inform();
		inform();
		inform();		
		
		f.disapprove("");
		exp += fall0 + fall1 + sugar;
		if (exp !== msg) throw new Error("Expected = " + exp + " but Actual = " + msg);		
		
		return true;
	});
	
	smokeTests.add("Future inform and then original swear", function () {
		
		var f,
			msg = "",
			exp = "",
			sugar = " sugar ",
			next0 = " next_0 ",
			fall0 = " fall_0 ",
			during0 = " during_0 ",
			next1 = " next_1 ",
			fall1 = " fall_1 ",
			during1 = " during_1 ";
		
		function inform() {
			f.inform("");
			exp += during0 + during1;
			if (exp !== msg) throw new Error("Expected = " + exp + " but Actual = " + msg);
		}
		
		function setup() {
			
			msg = exp = "";
			
			f = Future.newOne("f" + futureCounts++);
			
			f.andThen(
					function (txt) {
						msg += next0 + txt;
						return sugar;
					},
					function (txt) {
						msg += fall0 + txt;
						return sugar;				
					},
					function (txt) {
						msg += during0 + txt;
						return f.swear();
					}
			  )
			 .next(function (txt) {
					msg += next1 + txt;
			  })
			 .fall(function (txt) {	
					msg += fall1 + txt;	  
			  })
			 .during(function (txt) {
				msg += during1 + txt;
			 });
		 }
		
		setup();
		inform();
		inform();
		inform();		
		
		f.approve("");
		exp += next0 + next1 + sugar;
		if (exp !== msg) throw new Error("Expected = " + exp + " but Actual = " + msg);
		
		setup();
		inform();
		inform();
		inform();		
		
		f.disapprove("");
		exp += fall0 + fall1 + sugar;
		if (exp !== msg) throw new Error("Expected = " + exp + " but Actual = " + msg);		
		
		return true;
	});
	
	smokeTests.run();
	
	
</script>

</body>
</html>
